<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥çµŒè¡°å¼±ã‚²ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ã‚«ãƒ¼ãƒ‰ã®ãƒ•ãƒªãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .perspective-1000 {
            perspective: 1000px;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card.matched .card-front {
            background-color: #dcfce7; /* green-100 */
            border-color: #22c55e; /* green-500 */
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
        }

        /* ã‚«ãƒ¼ãƒ‰ã®è£é¢ï¼ˆæ¨¡æ§˜ï¼‰ */
        .card-back {
            background: linear-gradient(135deg, #6366f1 25%, #4f46e5 25%, #4f46e5 50%, #6366f1 50%, #6366f1 75%, #4f46e5 75%, #4f46e5 100%);
            background-size: 20px 20px;
            color: white;
            cursor: pointer;
        }

        .card-back:hover {
            opacity: 0.9;
        }

        /* ã‚«ãƒ¼ãƒ‰ã®è¡¨é¢ï¼ˆçµµæŸ„ï¼‰ */
        .card-front {
            background-color: white;
            transform: rotateY(180deg);
            border-color: #e2e8f0;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-8 px-4 font-sans text-gray-800">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ -->
    <header class="text-center mb-6">
        <h1 class="text-3xl font-bold text-indigo-600 mb-2">ç¥çµŒè¡°å¼±</h1>
        <p class="text-sm text-gray-500">åŒã˜çµµæŸ„ã®ãƒšã‚¢ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„</p>
    </header>

    <!-- ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ -->
    <div class="flex gap-6 mb-6 bg-white p-4 rounded-lg shadow-sm w-full max-w-md justify-around">
        <div class="text-center">
            <span class="block text-xs text-gray-500 uppercase font-bold">æ™‚é–“</span>
            <span id="timer" class="text-xl font-mono font-bold text-indigo-600">00:00</span>
        </div>
        <div class="text-center">
            <span class="block text-xs text-gray-500 uppercase font-bold">æ‰‹æ•°</span>
            <span id="moves" class="text-xl font-mono font-bold text-indigo-600">0</span>
        </div>
        <div class="text-center">
            <button onclick="restartGame()" class="bg-indigo-500 hover:bg-indigo-600 text-white text-sm font-bold py-1 px-4 rounded transition-colors mt-1">
                ãƒªã‚»ãƒƒãƒˆ
            </button>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ (4x4ã‚°ãƒªãƒƒãƒ‰) -->
    <div id="game-board" class="grid grid-cols-4 gap-3 w-full max-w-md aspect-square mb-8 perspective-1000">
        <!-- JavaScriptã§ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
    </div>

    <!-- ã‚¯ãƒªã‚¢ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰ -->
    <div id="win-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm mx-4 transform transition-all scale-100">
            <div class="text-5xl mb-4">ğŸ‰</div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼</h2>
            <p class="text-gray-600 mb-6">
                æ™‚é–“: <span id="final-time" class="font-bold">00:00</span><br>
                æ‰‹æ•°: <span id="final-moves" class="font-bold">0</span>
            </p>
            <button onclick="restartGame()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                ã‚‚ã†ä¸€åº¦éŠã¶
            </button>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ ã®è¨­å®š
        const emojis = ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼']; // 8ãƒšã‚¢ = 16æš
        let cards = [];
        let hasFlippedCard = false;
        let lockBoard = false;
        let firstCard, secondCard;
        let moves = 0;
        let matchedPairs = 0;
        let timerInterval;
        let seconds = 0;
        let gameStarted = false;

        const gameBoard = document.getElementById('game-board');
        const movesDisplay = document.getElementById('moves');
        const timerDisplay = document.getElementById('timer');
        const winModal = document.getElementById('win-modal');
        const finalTimeDisplay = document.getElementById('final-time');
        const finalMovesDisplay = document.getElementById('final-moves');

        // ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–
        function initGame() {
            // å¤‰æ•°ãƒªã‚»ãƒƒãƒˆ
            moves = 0;
            matchedPairs = 0;
            seconds = 0;
            hasFlippedCard = false;
            lockBoard = false;
            firstCard = null;
            secondCard = null;
            gameStarted = false;
            
            clearInterval(timerInterval);
            timerDisplay.innerText = '00:00';
            movesDisplay.innerText = '0';
            winModal.classList.add('hidden');
            
            // ã‚«ãƒ¼ãƒ‰ã®ç”Ÿæˆã¨ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            cards = [...emojis, ...emojis]; // ãƒšã‚¢ã‚’ä½œæˆ
            shuffle(cards);
            
            // ç›¤é¢ã®æç”»
            gameBoard.innerHTML = '';
            cards.forEach((emoji, index) => {
                const cardElement = createCardElement(emoji, index);
                gameBoard.appendChild(cardElement);
            });
        }

        // ã‚«ãƒ¼ãƒ‰è¦ç´ ã®ä½œæˆ
        function createCardElement(emoji, index) {
            const card = document.createElement('div');
            card.classList.add('card', 'relative', 'w-full', 'h-full', 'cursor-pointer');
            card.dataset.emoji = emoji;
            card.dataset.index = index;

            // HTMLæ§‹é€ : card > card-inner > (card-front + card-back)
            card.innerHTML = `
                <div class="card-inner w-full h-full relative transition-transform duration-500">
                    <div class="card-front card-face bg-white rounded-lg border-2 border-gray-200 flex items-center justify-center text-4xl">
                        ${emoji}
                    </div>
                    <div class="card-back card-face bg-indigo-500 rounded-lg flex items-center justify-center">
                        <span class="opacity-0">?</span>
                    </div>
                </div>
            `;

            card.addEventListener('click', flipCard);
            return card;
        }

        // ã‚·ãƒ£ãƒƒãƒ•ãƒ«é–¢æ•° (Fisher-Yates)
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // æ™‚é–“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatTime(totalSeconds) {
            const m = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            const s = (totalSeconds % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }

        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
        function startTimer() {
            if (!gameStarted) {
                gameStarted = true;
                timerInterval = setInterval(() => {
                    seconds++;
                    timerDisplay.innerText = formatTime(seconds);
                }, 1000);
            }
        }

        // ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹å‡¦ç†
        function flipCard() {
            if (lockBoard) return;
            if (this === firstCard) return; // åŒã˜ã‚«ãƒ¼ãƒ‰ã®ã‚¯ãƒªãƒƒã‚¯é˜²æ­¢

            startTimer(); // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ã§ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹

            this.classList.add('flipped');

            if (!hasFlippedCard) {
                // 1æšç›®
                hasFlippedCard = true;
                firstCard = this;
                return;
            }

            // 2æšç›®
            secondCard = this;
            incrementMoves();
            checkForMatch();
        }

        // ãƒãƒƒãƒåˆ¤å®š
        function checkForMatch() {
            let isMatch = firstCard.dataset.emoji === secondCard.dataset.emoji;

            isMatch ? disableCards() : unflipCards();
        }

        // ä¸€è‡´ã—ãŸå ´åˆ
        function disableCards() {
            lockBoard = true; // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ã¾ã§ãƒ­ãƒƒã‚¯
            
            // å°‘ã—é…ã‚‰ã›ã¦matchedã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ï¼ˆã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ç”¨ï¼‰
            setTimeout(() => {
                firstCard.classList.add('matched');
                secondCard.classList.add('matched');
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼å‰Šé™¤ã¯CSSã®pointer-eventsåˆ¶å¾¡ã§ã‚‚å¯èƒ½ã ãŒå¿µã®ãŸã‚
                firstCard.removeEventListener('click', flipCard);
                secondCard.removeEventListener('click', flipCard);

                resetBoard();
                matchedPairs++;
                
                // ã‚¯ãƒªã‚¢åˆ¤å®š
                if (matchedPairs === emojis.length) {
                    gameWon();
                }
            }, 500);
        }

        // ä¸€è‡´ã—ãªã‹ã£ãŸå ´åˆ
        function unflipCards() {
            lockBoard = true;

            setTimeout(() => {
                firstCard.classList.remove('flipped');
                secondCard.classList.remove('flipped');
                resetBoard();
            }, 1000); // 1ç§’é–“è¦‹ã›ã‚‹
        }

        // ç›¤é¢çŠ¶æ…‹ã®ãƒªã‚»ãƒƒãƒˆ
        function resetBoard() {
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }

        // æ‰‹æ•°ã®æ›´æ–°
        function incrementMoves() {
            moves++;
            movesDisplay.innerText = moves;
        }

        // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢å‡¦ç†
        function gameWon() {
            clearInterval(timerInterval);
            finalTimeDisplay.innerText = timerDisplay.innerText;
            finalMovesDisplay.innerText = moves;
            
            // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
            setTimeout(() => {
                winModal.classList.remove('hidden');
            }, 500);
        }

        // ã‚²ãƒ¼ãƒ ã®ãƒªã‚»ãƒƒãƒˆï¼ˆå†é–‹ï¼‰
        function restartGame() {
            initGame();
        }

        // åˆå›èµ·å‹•
        initGame();
    </script>
</body>
</html>
